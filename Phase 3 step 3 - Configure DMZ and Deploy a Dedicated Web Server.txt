Phase 3, Step 3: Configure DMZ and Deploy a Dedicated Web Server
The goal here is to create a segregated network zone (DMZ) where public-facing services (like your web server) reside, separate from your internal LAN and Active Directory. We'll then put a web server in this DMZ.

A. Configure the DMZ Network in VirtualBox
First, let's ensure your pfSense_Firewall VM has an interface dedicated to the DMZ, and then define that "Internal Network" in VirtualBox.

Shut down your pfSense_Firewall VM if it's currently running.
Select pfSense_Firewall VM in VirtualBox Manager.
Go to "Settings" -> "Network".
Verify/Add Adapter 3 (DMZ):
Click on the "Adapter 3" tab.
Ensure "Enable Network Adapter" is checked.
Attached to: This must be set to Internal Network.
Name: It's crucial that this name is unique and descriptive, for instance, Homelab_DMZ. Make sure you type this exact name.
Advanced: Expand "Advanced" and set Promiscuous Mode to Allow All.
Click "OK" to save these settings.
B. Configure the DMZ Interface (OPT1) in pfSense
Now we'll tell pfSense to use this new adapter as its DMZ interface and assign it a new IP subnet.

Start your pfSense_Firewall VM.

Log in to the pfSense console in the VM window.

Assign Interfaces:

From the main menu (if it doesn't prompt you, type 1 and press Enter for "Assign Interfaces").
You'll likely see your WAN (e.g., em0) and LAN (e.g., em1) already assigned.
It will ask if you want to assign an optional interface. Type y and press Enter.
It will list unassigned interfaces (e.g., em2). This should correspond to the Adapter 3 you just configured in VirtualBox.
Enter the name of the unassigned interface (e.g., em2) for OPT1.
Press Enter for OPT2 (unless you plan to add more soon).
Confirm your changes by typing y and pressing Enter.
You'll be returned to the main menu, and OPT1 should now be listed.
Configure IP Address and DHCP for OPT1 (DMZ):

From your AD_Domain_Controller VM, open a web browser and go to http://192.168.1.1 (your pfSense web GUI). Log in (admin/pfsense).
Go to Interfaces -> OPT1.
Enable Interface: Check "Enable interface".
Description: Change to DMZ.
IPv4 Configuration Type: Static IPv4.
IPv4 Address: Enter a new subnet for your DMZ, for example: 192.168.2.1 and select /24 from the dropdown. (This means your DMZ network will be 192.168.2.0/24).
Click "Save" at the bottom.
Click "Apply Changes" at the top.
Enable DHCP Server for DMZ:

Go to Services -> DHCP Server -> DMZ (or OPT1) tab.
Enable DHCP server on DMZ interface: Check this box.
Range: Set the range for IP addresses that DHCP will hand out. For example, 192.168.2.100 to 192.168.2.199.
DNS Servers: You can point this to your AD Domain Controller's IP (192.168.1.10) for consistency, or simply 192.168.2.1 (pfSense itself) which will then forward to your global DNS or AD. For a DMZ, pointing directly to a public DNS like Google's 8.8.8.8 or 1.1.1.1 might be more realistic, but for lab purposes let's just point to pfSense. Let's use 192.168.2.1.
Click "Save".
C. Create a New VM for the DMZ Web Server (Ubuntu Server)
It's best practice to put public-facing web servers on a dedicated VM in the DMZ. We'll use another Ubuntu Server, as it's lightweight and easy to manage.

Open VirtualBox and click "New".

Name and Operating System:

Name: DMZ_Web_Server
Folder: Keep default or choose a preferred location.
ISO Image: Use the same Ubuntu Server ISO you downloaded earlier.
Type: Linux
Version: Ubuntu (64-bit)
Skip Unattended Installation: Checked.
Click "Next".
Hardware (RAM and CPU):

Base Memory (RAM): 1024 MB (1GB) or 2048 MB (2GB) is sufficient for a basic web server.
Processors: 1 CPU.
Click "Next".
Virtual Hard Disk:

Disk Size: 25 GB.
Keep it Dynamically allocated.
Click "Next".
Summary: Review settings and click "Finish".

D. Configure Network Adapter for DMZ Web Server VM
Crucially, this VM needs to connect to your newly defined DMZ internal network.

Select DMZ_Web_Server VM (do not start it yet).
Click "Settings" -> "Network".
Adapter 1:
Ensure "Enable Network Adapter" is checked.
Attached to: Change this to Internal Network.
Name: Select the exact same internal network name you used for pfSense's DMZ interface: Homelab_DMZ.
Advanced: Set Promiscuous Mode to Allow All.
Click "OK" to save the settings.
E. Install Ubuntu Server and Apache/Nginx on DMZ Web Server
Start your DMZ_Web_Server VM.

Install Ubuntu Server: Follow the same installation steps as you did for your first Ubuntu VM.

Remember to select "Install OpenSSH server" during installation for easy remote management.
Create a user account and password for this server.
After installation, log in to the DMZ_Web_Server VM.

Verify Network Configuration:

Run ip a. You should get an IP address in the 192.168.2.x range (e.g., 192.168.2.100), assigned by pfSense's DHCP server for the DMZ.
Test pinging your pfSense DMZ interface: ping 192.168.2.1
Test pinging an external website: ping google.com (This should work, as pfSense will route it out via NAT).
Install a Web Server (Apache2 is simpler for a basic web page):

Bash

sudo apt update
sudo apt upgrade -y
sudo apt install apache2 -y
Verify Apache is Running:

Bash

sudo systemctl status apache2
It should show "active (running)".

Test Web Server from DMZ:

From within the DMZ_Web_Server VM's console, you can use curl to test:
Bash

curl http://localhost
You should see the HTML content of the default Apache welcome page.
Test Web Server from your AD_Domain_Controller VM (or Win10_Client VM):

Crucial: By default, pfSense will block traffic from your LAN to your DMZ. We need to create a firewall rule for this later. So, initially, this test will fail. This is expected and demonstrates the segmentation.
From your Win10_Client VM, open a browser and try to go to http://192.168.2.x (the IP of your DMZ_Web_Server). It should time out. This confirms your DMZ is isolated from your LAN.